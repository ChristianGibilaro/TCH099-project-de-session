<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Sign-up</title>
  <link rel="icon" href="ressources/Final/Main/logo.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="Scripts/animationScript.js" defer></script>
  <script src="Scripts/ElementCreator.js"></script>
  <script src="Scripts/globalVars.js"></script>
  <script src="Scripts/mainScript.js"></script>

  <link rel="stylesheet" href="Styles/normalize.css">
  <link rel="stylesheet" href="Styles/Demonstrateur.css">

</head>

<script>
  var creator = new ElementCreator(document.title);
  var API = new mainScript(document.title);
  console.log(document.title);
</script>

<body>
  <!------------------------------------------------ SECTION Ω - MENU ---------------------------------------------->
  <header onclick="toggleMenu()">
    <script>
      document.write(creator.PrefabMenu);
    </script>
  </header>
  <div id="dimmer" onclick="toggleMenu()"></div>

  <div id="contenu">

    <div id="head">
      <script>
        document.write(creator.CreateHero("ressources/Final/Main/moonDarkSign.png", "ressources/Commun/logo_example.png"));
      </script>
    </div>

    <!------------------------------------------------ SECTION 5 - FORM ---------------------------------------------->

    <script>

      // --- Configuration Object for the Dynamic Form ---
      const dynamicFormConfig = {
        formTitle: "Créer un compte",
        formId: "form_new_user_id",
        formMethod: "POST",
        formEnctype: "multipart/form-data", // Essential for file uploads
        inputConfig: [
          { type: 'text', label: 'Pseudonym', name: 'pseudonym', required: true },
          { type: 'text', label: 'Name', name: 'nom', required: true },
          { type: 'email', label: 'Email', name: 'email', required: true },
          { type: 'password', label: 'Password', name: 'password', required: true },
          { type: 'password', label: 'Confirm password', name: 'password2', required: true },
          { // --- Switchable Image Input (URL or File) ---
            type: 'switchable',
            label: 'Profil image',         // Translated label for the group
            name: 'image',      // Base name for the group (used for IDs)

            type1: { // Configuration for the URL input option
              type: 'url',
              label: 'URL',        // Translated label specific to this mode
              name: 'imageLink',       // Name the backend expects for URL
              placeholder: 'https://example.com/image.png',
              required: true                 // Image is required if URL mode is active (set false if optional)
            },
            type2: { // Configuration for the File input option
              type: 'file',
              label: 'Upload',    // Translated label specific to this mode
              name: 'image',      // Name the backend expects for File
              required: true                 // Image is required if File mode is active (set false if optional)
            },
            defaultType: 'type2', // Show the URL input first by default
            switchButtonText: "Or %typeLabel%" // Custom text for the switch button (uses other type's label)
          },
          { // --- Switchable Image Input (URL or File) ---
            type: 'switchable',
            label: 'background image',         // Translated label for the group
            name: 'image',      // Base name for the group (used for IDs)

            type1: { // Configuration for the URL input option
              type: 'url',
              label: 'URL',        // Translated label specific to this mode
              name: 'backg_imageLink',       // Name the backend expects for URL
              placeholder: 'https://example.com/image.png',
              required: true                 // Image is required if URL mode is active (set false if optional)
            },
            type2: { // Configuration for the File input option
              type: 'file',
              label: 'Upload',    // Translated label specific to this mode
              name: 'backg_image',      // Name the backend expects for File
              required: true                 // Image is required if File mode is active (set false if optional)
            },
            defaultType: 'type2', // Show the URL input first by default
            switchButtonText: "Or %typeLabel%" // Custom text for the switch button (uses other type's label)
          },
          { type: 'textarea', label: 'Description', name: 'description', required: true }, // Assuming description is required
          { type: 'text', label: 'language', name: 'language_name', required: true }, // Assuming language_id is required
          { type: 'text', label: 'location', name: 'position_name', required: false }, // Assuming language_id is required
          { type: 'date', label: 'Birth date', name: 'age', required: true },
          { type: 'checkbox', label: "I accept the ", name: 'agreement', value: 'accepted', required: true, labelLink: '/terms-and-conditions', text : "terms and conditions" } // Example link
        ],
        submitButtonText: "Create an account",
        loginLink: "Sign-in.html", // URL for the login page link
        loginLinkText: "Already have an account ? Connect " // Text for the login link (<a> tag added by CreateDynamicForm)
      };

      // --- Generate the Form HTML ---
      // Assuming 'creator.CreateDynamicForm' function exists and is defined as previously discussed
      const generatedDynamicFormHTML = creator.CreateDynamicForm(
        dynamicFormConfig.formTitle,
        dynamicFormConfig.formId,
        dynamicFormConfig.formMethod,
        dynamicFormConfig.formEnctype,
        dynamicFormConfig.inputConfig,
        dynamicFormConfig.submitButtonText,
        dynamicFormConfig.loginLink,
        dynamicFormConfig.loginLinkText
      );

      document.write(generatedDynamicFormHTML);
      document.getElementById('soummission_btn').addEventListener('click', API.creerUser);
      document.addEventListener('DOMContentLoaded', function() {
        initializeSwitchableInputs();

      });

      async function fetchFilterOptions(filterType, id,name,placeholder) {
          const response = await fetch(`http://localhost:9999/api/filter/${id}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ "filterType": filterType })
          });
          const data = await response.json();
          if (!data.elements || !Array.isArray(data.elements)) return [[], []];

          const names = ["--Clear--"];
          names.push(...data.elements.map(e => e.Name));
          const ids = data.elements.map(e => e.ID);
          console.log(names, ids);
          var out = creator.CreateFilterTextbox(names,placeholder,name);
          console.log(out);
          document.getElementById(name).replaceWith(...out.children);
          return [names, ids];
        }   
        fetchFilterOptions('LanguageFilter',1,"language_name","Position");
        fetchFilterOptions('PositionFilter',1,"position_name","Language");
    </script>

  </div>
</body>

</html>