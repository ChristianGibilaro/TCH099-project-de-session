<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Activity</title>
  <link rel="icon" href="ressources/Final/Main/logo.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="Scripts/animationScript.js" defer></script>
  <script src="Scripts/ElementCreator.js"></script>
  <script src="Scripts/globalVars.js"></script>
  <script src="Scripts/mainScript.js"></script>

  <link rel="stylesheet" href="Styles/normalize.css">
  <link rel="stylesheet" href="Styles/Demonstrateur.css">

</head>

<script>
  var creator = new ElementCreator(document.title);
  var API = new mainScript(document.title);
  console.log(document.title);
  // ---------------------------------------------- API DATA ----------------------------------------------


  var elements =
    [["https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/553850/header.jpg", "Te3te", "Long texte"],
    ["https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/1245620/header.jpg?t=1739922037", "T2e", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/12e1bd007bebc8ffe7e9fad77ea3e6b6.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/a779abf92aeec12331d10524426171fb.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/e214786a5ff033e8ad5d57501bf82a16.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/928f27d1a6ae1828ad77b45f2d424dbf.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/8edc69aa76b7aac408ba3c248aa8d7d4.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/ea3a48c74a9efb9a08635fe7990347cc.jpg", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/994d88a370250b303be16fc98bb5cdac.png", "Texte", "Long texte"],
    ["https://cdn2.steamgriddb.com/thumb/db3a47863b50389cccce3066cf7f7a53.jpg", "Texte", "Long texte"],];
  var titles = ['nein', "Texte", "Long texte"];

  var titleType = [["txt"], ["txt"], ["txt"]];
  var titlesRow = creator.CreateTableTitles(titles, [40, 40, 20], 3, null, null, null);

  var rowType = [["img", "100%", "160px", "image_failed", "FillImage", "object-fit: cover; object-position: 1% 40%;"], ["txt"], ["txt"]];
  var rows = creator.CreateTableRows(elements, rowType, [20, 60, 20], 3, null, null, "text-align: center;");

  const helldiversPlanets = [
    "Acamar IV",
    "Acerbitas",
    "Acretia",
    "Aesir Pass",
    "Angel's Venture",
    "Charon Prime",
    "Choohe",
    "Cratérus",
    "Crimsica",
    "Draupnir",
    "Durgen",
    "Emeria",
    "Erata Prime",
    "Esker",
    "Estanu",
    "Fenrir III",
    "Fori Prime",
    "Frosthorn",
    "Heeth",
    "Hellmire",
    "Heze Bay",
    "Ingmar",
    "Isen IV",
    "Kavis",
    "Keid",
    "Kraz",
    "Lestrade",
    "Maia",
    "Malevelon Creek",
    "Marfark",
    "Martale",
    "Matar Bay",
    "Mefst",
    "Meridia",
    "Mort",
    "Nivel IV",
    "Obari",
    "Oshaune",
    "Penta",
    "Pöpli IX",
    "Provost",
    "Pythea Bay",
    "Seyshel Beach",
    "Skarv",
    "Sutnar",
    "Thanatos",
    "The Fold",
    "Thera",
    "Tibit",
    "Troost",
    "Turing",
    "Ubanea",
    "Ustotu",
    "Vandalon IV",
    "Varylia 5",
    "Vernen Wells", // Sometimes appears as Vanern Wells
    "X-45",
    "Zagon Prime"
  ];

</script>

<body>
  <!------------------------------------------------ SECTION Ω - MENU ---------------------------------------------->
  <header onclick="toggleMenu()">
    <script>
      document.write(creator.PrefabMenu);
    </script>
  </header>
  <div id="dimmer" onclick="toggleMenu()"></div>


  <div id="contenu" style="height: 100%;">

    <div id="head">
      <script>
        document.write(creator.CreateHero("ressources/Final/Main/moonDarkSign.png", "ressources/Commun/logo_example.png"));
      </script>
    </div>

    <div class="barre-filtres" id="in1">
      <script>
        window.addEventListener("load", (event) => { initializePagination("fatherland"); });
        document.getElementById("in1").append(creator.CreateFilterTextbox(helldiversPlanets, "Find a planet to liberate"));
        document.getElementById("in1").append(creator.CreateCheckList(helldiversPlanets, "(Click to Open) Find a planet to liberate"));
      </script>

      <div class="bloc-filtre">
        <input type="number" id="filtre-nombre" placeholder="Nombre (ex: 10)" min="0" max="100" step="1">
      </div>

      <div class="bloc-filtre">
        <input type="datetime-local" id="filtre-datetime">
      </div>

      <div class="bloc-filtre filtre-checkboxes">
        <label><input type="checkbox" name="categorie" value="tshirt"> T-shirt</label>
      </div>
    </div>



    <div id="fatherland" class="contenu-onglet">
      <div class="page-content" id="page-content-container " style="height: 100%;">
        <div class="page-item active">
          
          <script>
async function fetchActivities() {
  const response = await fetch('http://localhost:9999/api/activity/all', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      limit: 40,
      fields: [
        "ID", "Title", "Main_Img", "Description", "Logo_Img", "Point_Value",
        "Word_4_Player", "Word_4_Teammate", "Word_4_Playing",
        "Main_Color", "Second_Color", "Friend_Main_Color", "Friend_Second_Color"
      ],
      activityDataFields: [
        "Team_Count", "QuickTeam_Count", "Player_Count", "Active_Player_Count"
      ]
    })
  });
  const data = await response.json();
  // Extract array of {activity, activityData, ...}
  const activities =
    Array.isArray(data.activities) ? data.activities
    : Array.isArray(data.data) ? data.data
    : Array.isArray(data) ? data
    : [];

  // Merge activity and activityData for each item
  const merged = activities.map(item => ({
    ...(item.activity || {}),
    ...(item.activityData && typeof item.activityData === "object" ? item.activityData : {})
  }));

  const activityList = creator.superScrollableList({
    mode: "masonry",
    items: merged,
    width: "100%",
    height: "100%",
    renderItem: (activity, idx) => {
      const playerCount = activity.Player_Count ?? activity.player_count ?? 0;
      const word4player = activity.Word_4_Player || "player";
      const teamCount = activity.Team_Count ?? activity.team_count ?? "";
      const activePlayerCount = activity.Active_Player_Count ?? activity.active_player_count ?? "";
      const activityId = activity.ID || activity.Id || activity.id || "";

      let statBlock = `
        <div style="padding:4px 0 12px 0;text-align:left;min-width:90px;font-size:0.95em;">
          <div><b>${playerCount}</b> ${word4player}</div>
          <div><b>${teamCount||"-"}</b> Teams</div>
          <div><b>${activePlayerCount||"-"}</b> active</div>
          <div style="color:var(--accent2);font-size:0.9em;">${activity.Point_Value ? `Points: ${activity.Point_Value}` : ""}</div>
        </div>
      `;

      let mainImg = `
        <div style="position:relative;width:100%;overflow:hidden;border-radius:12px;">
          <img src="${activity.Main_Img || ""}" style="width:100%;display:block;object-fit:cover;max-height:180px;filter:brightness(0.92);">
          ${activity.Logo_Img ? `
            <img src="${activity.Logo_Img}" style="position:absolute;top:12px;left:12px;width:48px;height:48px;object-fit:contain;background:white;border-radius:8px;box-shadow:0 2px 8px #0002;">
          ` : ""}
        </div>
      `;

      let title = `
        <div style="text-align:center;font-weight:bold;font-size:1.2em;margin:12px 0 6px 0;color:var(--accent2);">
          ${activity.Title || ""}
        </div>
      `;

      let desc = `
        <div style="padding:4px 0 0 0;white-space:pre-line;font-size:1em;">${activity.Description || ""}</div>
      `;

      // The whole tile is clickable and redirects to Activity.html?id=...
      return `
        <div class="activity-card" 
             style="background:var(--bg-dark2);border-radius:14px;box-shadow:var(--shadow);margin-bottom:20px;overflow:hidden;cursor:pointer;transition:box-shadow 0.15s;"
             onclick="window.location.href='Activity.html?id=${encodeURIComponent(activityId)}'">
          ${mainImg}
          <div style="display:flex;gap:18px;padding:14px 14px 10px 14px;">
            <div style="flex:0 0 90px;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;">
              ${statBlock}
            </div>
            <div style="flex:1;min-width:0;">
              ${title}
              ${desc}
            </div>
          </div>
        </div>
      `;
    }
  });

  const target = document.querySelector('#fatherland .page-item.active');
  if (target) {
    target.innerHTML = "";
    target.append(activityList);
  }
}
fetchActivities();
          </script>>



        </div>
        <div class="page-item">
          <script>
            document.write(creator.PutInDiv(creator.CreateScrollableTable("100%", "100%", "", rows, null, null, " margin-top:20px;"), null, "CenterChilds", "height: 100%"));
          </script>
        </div>
        <div class="page-item">
          <script>
            document.write(creator.PutInDiv(creator.CreateScrollableTable("100%", "100%", "", rows, null, null, " margin-top:20px;"), null, "CenterChilds", "height: 100%"));
          </script>
        </div>
        <div class="page-item">
          <script>

          </script>
        </div>
        <div class="page-item">
          <script>
            document.write(creator.PutInDiv(creator.CreateScrollableTable("100%", "100%", "", rows, null, null, " margin-top:20px;"), null, "CenterChilds", "height: 100%"));
          </script>
        </div>
      </div>
      <div class="pagination" id="pagination-container">
        <button class="prev-page">&lt; Previous</button>
        <button class="next-page">Next &gt;</button>
      </div>
    </div>


  </div>

</body>

</html>