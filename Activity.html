<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Activity</title>
  <link rel="icon" href="ressources/Final/Main/logo.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="Scripts/animationScript.js" defer></script>
  <script src="Scripts/ElementCreator.js"></script>
  <script src="Scripts/globalVars.js"></script>
  <script src="Scripts/mainScript.js"></script>

  <link rel="stylesheet" href="Styles/normalize.css">
  <link rel="stylesheet" href="Styles/Demonstrateur.css">
</head>

<script>
  var creator = new ElementCreator(document.title);
  var API = new mainScript(document.title);

  async function fetchAndRenderActivity() {
    // Extract activity ID from URL (?id=...)
    const urlParams = new URLSearchParams(window.location.search);
    const activityId = urlParams.get('id') || urlParams.keys().next().value;
    if (!activityId) return;

    const response = await fetch(`http://localhost:9999/api/activity/id/${activityId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fields: {
          activity: [
            "ID",
            "Title",
            "Description",
            "Main_Img",
            "Logo_Img",
            "Point_Value",
            "Word_4_Player",
            "Main_Color",
            "Second_Color"
          ],
          activityData: [
            "ActivityID",
            "Player_Count",
            "Active_Player_Count",
            "Rating"
          ]
        }
      })
    });
    const result = await response.json();
    if (result.success && result.data) {
      const activity = result.data.activity || {};
      const activityData = result.data.activityData || {};
      document.title = activity.Title || "Activity";

      // Fill variables
      const title = activity.Title || "";
      const MainImg = activity.Main_Img || "";
      const LogoImg = activity.Logo_Img || "";
      const Description = activity.Description || "";
      const playerCount = activityData.Player_Count || 0;
      const word4player = activity.Word_4_Player || "Player";
      const activePlayerCount = activityData.Active_Player_Count || 0;
      const word4Playing = activity.Word_4_Playing || "Playing";
      const teamCount = activityData.Team_Count || 0;

      document.getElementById('head').innerHTML =
        creator.CreateHero(MainImg, LogoImg) +
        creator.CreateDesc(
          Description,
          `<strong>${playerCount}</strong> ${word4player}<br>
           <strong>${activePlayerCount}</strong> ${word4Playing}<br>
           <strong>${teamCount}</strong> Teams<br>`
        );
    }
  }

  document.addEventListener('DOMContentLoaded', fetchAndRenderActivity);
</script>

<body>
  <!------------------------------------------------ SECTION Î© - MENU ---------------------------------------------->
  <header onclick="toggleMenu()">
    <script>
      document.write(creator.PrefabMenu);
    </script>
  </header>
  <div id="dimmer" onclick="toggleMenu()"></div>

  <div id="contenu" style="height: 100%;">
    <div id="head"></div>
    <div id="fatherland" class="contenu-onglet"></div>
  </div>
</body>

</html>